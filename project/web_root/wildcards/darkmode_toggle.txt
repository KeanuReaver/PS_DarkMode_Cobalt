<span id="darkModeToggleSpan" style="padding-right:20px;">
    Dark Mode:
    <label class="student-blur-switch">
        <input type="checkbox" id="darkModeChbx" name="darkModeChbx">
        <span id="student-dark-slider"></span>
    </label>
</span>

<style>
    .student-blur-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
        vertical-align: middle;
    }
    .student-blur-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    #student-dark-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: red;
        transition: 0.4s;
        border-radius: 24px;
        width: 50px;
        height: 24px;
    }
    #student-dark-slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 2px;
        bottom: 2px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
    }

    @media (prefers-color-scheme: dark) {
        body:not(.disable-dark-mode) #darkModeToggleSpan {
            color: #cbd2d9;
        }

        body:not(.disable-dark-mode) #student-dark-slider {
            background-color: #444;
        }

        body:not(.disable-dark-mode) .student-blur-switch input:checked + #student-dark-slider {
            background-color: #2ecc71;
        }

        body:not(.disable-dark-mode) #student-dark-slider:before {
            background-color: #fff;
        }
    }   
</style>

<script>
    $j(() => {
        const darkKey = "ucsd_dark_mode";

        function applyDarkMode() {
            const userPref = localStorage.getItem(darkKey); // "1", "0", or null
            const systemPref = window.matchMedia("(prefers-color-scheme: dark)").matches;
            const isDark = userPref === "1" || (userPref === null && systemPref);

            $j("#darkModeChbx").prop("checked", isDark);

            (isDark) ? $j("body").addClass("set-to-dark") : $j("body").removeClass("set-to-dark");
        }

        $j("#currentscope").prepend($j("#darkModeToggleSpan"));

        applyDarkMode();

        // Watch for changes
        $j("#darkModeChbx").on("change", function () {
            localStorage.setItem(darkKey, this.checked ? "1" : "0");
            applyDarkMode();
        });

        // Watch for system preference change (optional)
        window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", () => {
            if (localStorage.getItem(darkKey) === null) {
                applyDarkMode(); // only reapply if no user override
            }
        });
    });
</script>